"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,o=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(r=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){var e,t=document.getElementById("msg"),n=localStorage.getItem("clashEditor:config:proxy"),p=CodeMirror(document.getElementById("proxy-editor"),{lineNumbers:!0,mode:"yaml"});n&&""!==n?p.setValue(n):p.setValue("Proxy:\n"),document.getElementById("ce-proxy-btn-validate").addEventListener("click",function(){try{e=jsyaml.load(p.getValue());try{if(e.Proxy)try{e.Proxy.map(function(e){if(e.type&&"ss"!==e.type&&"vmess"!==e.type&&"socks5"!==e.type&&"http"!==e.type&&"snell"!==e.type)throw new Error(e.type)}),setLS("clashEditor:config:proxy",p.getValue()),t.innerHTML='<span class="text-success">Proxy 配置检查通过！</span>',document.getElementById("ce-proxy-btn-continue").classList.remove("disabled"),document.getElementById("ce-proxy-btn-continue").removeAttribute("disabled"),document.getElementById("ce-proxy-btn-continue").setAttribute("href","/proxygroup")}catch(e){Modal("您的 Proxy 配置不符合要求！","<code>".concat(e,"</code> 不是 ClashEditor 可以辨识的代理类型！"))}else Modal("您的 Proxy 配置不符合要求！","Proxy 配置必须包括 <code>Proxy:</code>，并且 <code>Proxy:</code> 下的内容不能为空！")}catch(e){Modal("您的 Proxy 配置不符合要求！","请检查您的 Proxy 配置并重新输入！")}}catch(e){Modal("这看起来不太正常","<p>Clash Editor 似乎不能解析您提交的 YAML 内容</p>\n                <p>报错信息如下所示：</p>\n                <p><code>".concat(e,"</code></p>\n                <p>如果您认为这不是您的问题，请在 Clash Editor 的 GitHub 上提交一条 issue，并在 issue 中附上报错信息以供调试</p>"))}}),document.getElementById("ss-form").addEventListener("submit",function(e){e.preventDefault();var t="".concat(p.getValue(),'\n- name: "').concat(getValue("ss-name"),'"\n  type: ss\n  server: ').concat(getValue("ss-server"),"\n  port: ").concat(getValue("ss-port"),"\n  cipher: ").concat(getValue("ss-cipher"),'\n  password: "').concat(getValue("ss-password"),'"\n  udp: ').concat(getValue("ss-udp"),"\n");p.setValue(t),document.getElementById("ss-form").reset(),$("#ss-helper").modal("hide")}),document.getElementById("vmess-form").addEventListener("submit",function(e){e.preventDefault();var t="".concat(p.getValue(),'\n- name: "').concat(getValue("vmess-name"),'"\n  type: vmess\n  server: ').concat(getValue("vmess-server"),"\n  port: ").concat(getValue("vmess-port"),"\n  uuid: ").concat(getValue("vmess-uuid"),"\n  alterId: ").concat(getValue("vmess-alterId"),"\n  cipher: ").concat(getValue("vmess-cipher"),"\n  udp: ").concat(getValue("vmess-udp"),"\n  tls: ").concat(getValue("vmess-tls"),"\n");p.setValue(t),document.getElementById("vmess-form").reset(),$("#vmess-helper").modal("hide")});document.getElementById("ce-proxy-btn-import-online").addEventListener("click",function(){var n=getValue("proxy-online-url");(function(e,t){return fetch(e,{method:"GET"}).then(function(e){return"text"===t?Promise.all([e.ok,e.status,e.text(),e.headers]):Promise.all([e.ok,e.status,e.json(),e.headers])}).then(function(e){var t=_slicedToArray(e,4),n=t[0],r=t[1],o=t[2],a=t[3];if(n)return{ok:n,status:r,data:o,headers:a}}).catch(function(e){throw e})})("https://cors-anywhere.herokuapp.com/".concat(n),"text").then(function(e){var t=jsyaml.load(e.data);if(!t.Proxy||""===t.Proxy)throw new Error("从 ".concat(n," 下载的文件中没有找到 Proxy 字段或 Proxy 字段为空！"));p.setValue("Proxy:\n".concat(jsyaml.dump(t.Proxy))),$("#online-helper").modal("hide")}).catch(function(e){$("#online-helper").modal("hide"),Modal("这看起来不太正常","<p>Clash Editor 不能解析您提交的在线托管配置</p>\n                    <p>报错信息如下所示：</p>\n                    <p><code>".concat(e,"</code></p>\n                    <p>这可能是由于您提交了错误的在线托管配置的 URL，或者在线托管配置不是合法的 YAML。"))})}),document.getElementById("surge-form").addEventListener("submit",function(e){e.preventDefault();for(var t=[],n=parseIni(getValue("surge-ini-textarea")).Proxy,r=0,o=Object.entries(n);r<o.length;r++){var a=_slicedToArray(o[r],2),s=a[0],c=a[1].split(",");4<c.length&&c[5].includes("SSEncrypt.module")&&t.push({name:s,type:"ss",server:c[1],port:c[2],cipher:c[3],password:c[4],udp:!0})}for(var l="Proxy:\n",u=0,d=t;u<d.length;u++){var i=d[u];l+='- name: "'.concat(i.name,'"\n  type: ss\n  server: ').concat(i.server,"\n  port: ").concat(i.port,"\n  cipher: ").concat(i.cipher,'\n  password: "').concat(i.password,'"\n  udp: true\n')}p.setValue(l),document.getElementById("surge-form").reset(),$("#surge-helper").modal("hide")})}();